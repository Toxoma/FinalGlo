(()=>{"use strict";const t=function(){var t="Все услуги",e=function(e,n){var o=document.getElementById("tbody"),a=n;e!==t&&(a=n.filter((function(t){return t.type===e}))),o.textContent="",a.forEach((function(t){o.insertAdjacentHTML("beforeend",'\n      <tr class="table__row">\n      <td class="table__id table__cell">'.concat(t.id,'</td>\n      <td class="table-type table__cell">').concat(t.type,'</td>\n      <td class="table-name table__cell">\n      ').concat(t.name,'\n      </td>\n      <td class="table-units table__cell">\n      ').concat(t.units,'\n      </td>\n      <td class="table-cost table__cell">\n      ').concat(t.cost,' руб\n      </td>\n\n      <td>\n        <div class="table__actions table__cell">\n          <button value=').concat(t.id,' class="button action-change"><span class="svg_ui"><svg class="action-icon_change"><use xlink:href="./img/sprite.svg#change"></use></svg></span><span>Изменить</span>\n          </button>\n          <button value=').concat(t.id,' class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove"><use xlink:href="./img/sprite.svg#remove"></use></svg></span><span>Удалить</span>\n          </button>\n        </div>\n      </td>\n    </tr>\n      '))}))};fetch("http://localhost:3000/api/items",{method:"GET"}).then((function(t){if(200!==t.status)throw new Error("status network not 200");return t.json()})).then((function(n){!function(n){var o=document.getElementById("typeItem"),a=new Set;for(var c in a.add(t),o.textContent="",n)a.add(n[c].type);a.forEach((function(t){o.insertAdjacentHTML("beforeend",'\n        <option value="'.concat(t,'">').concat(t,"</option>\n      "))})),e(t,n),o.addEventListener("change",(function(t){e(t.target.options[t.target.selectedIndex].textContent,n)}))}(n)})).catch((function(t){console.error(t)}))},e=function(e,n){var o=function(t){t.querySelectorAll("input").forEach((function(t){t.value=""}))},a=function(){var t=document.createElement("div");t.className="mistake-block",t.insertAdjacentHTML("afterbegin","\n    Ошибка отправки формы!!!\n    "),document.body.append(t),setTimeout((function(){t.classList.add("disapeare"),setTimeout((function(){t.remove()}),2e3)}),1e3)};!function(){try{var c=e.querySelectorAll("input"),i={};c.forEach((function(t){if("cost"===t.dataset.info){if(isNaN(+t.value))throw a(),Error("тип данныз не тот!");i[t.dataset.info]=+t.value}else i[t.dataset.info]=t.value+""})),n?(s=i,fetch("http://localhost:3000/api/items/".concat(n),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((function(n){if(200!==n.status&&201!==n.status)throw new Error("status network not 200");o(e),t(),document.getElementById("modal").click()})).catch((function(t){console.error(t),o(e),a()}))):function(n){fetch("http://localhost:3000/api/items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(n){if(200!==n.status&&201!==n.status)throw new Error("status network not 200");o(e),t(),document.getElementById("modal").click()})).catch((function(t){console.error(t),o(e),a()}))}(i)}catch(t){console.error("error: ",t)}var s}();var c=document.createElement("style");c.textContent="\n  .mistake-block{\n    position: fixed;\n    font-size: 30px;\n    color: red;\n    top: 50%;\n    left: 38%;\n    z-index: 999;\n    background-color: black;\n    padding: 20px;\n    border-radius: 20px;\n    border: 4px solid red;\n    transition: 2s;\n  }\n  @media (max-width: 1024px) {\n    .mistake-block {\n      left: 30%;\n    }\n  }\n  @media (max-width: 786px) {\n    .mistake-block {\n      left: 20%;\n    }\n  }\n  .disapeare{\n    opacity: 0;\n  }\n  ",document.querySelector("head").insertAdjacentElement("beforeend",c)},n=function(t,n){var o=document.querySelector(".btn-addItem"),a=document.getElementById("modal"),c=a.querySelector("form");a.style.display="block",a.style.visibility="hidden";var i=function(t){t.preventDefault(),n?e(t.target,n[0].textContent.trim()):e(t.target)},s=function t(e){e.target.closest(".modal")&&!e.target.closest(".button__close")||(a.style.visibility="hidden",document.removeEventListener("click",t),c.removeEventListener("submit",i))},r=function(){a.style.visibility="visible",setTimeout((function(){document.addEventListener("click",s)}),100)};"add"===t&&o.addEventListener("click",(function(){r(),c.addEventListener("submit",i)})),"change"===t&&(function(){var t=c.querySelectorAll("input");r();for(var e=0;e<t.length;e++){var o=n[e+1].textContent.trim();/\sруб/.test(o)&&(o=o.replace(/\sруб/,"")),t[e].value=o}}(),c.addEventListener("submit",i));var l=document.createElement("style");l.textContent="\n    .modal{\n      left: ".concat(a.clientWidth/2-225,"px;\n      top:100px;\n    }\n  "),document.querySelector("head").insertAdjacentElement("beforeend",l)};(function(){var t=localStorage.getItem("token");if(!t||"undefined"===t){var e=window.location.href;e=e.substring(0,e.lastIndexOf("/")),window.location.href=e}})(),t(),n("add"),document.addEventListener("click",(function(e){e.target.closest(".action-remove")&&function(e){var n=e.target.closest(".action-remove").value;fetch("http://localhost:3000/api/items/".concat(n),{method:"DELETE"}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("status network not 200");t()})).catch((function(t){console.error(t)}))}(e),e.target.closest(".action-change")&&function(t){var e=t.target.closest(".table__row").querySelectorAll("td");n("change",e)}(e)}))})();